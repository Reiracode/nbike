(this.webpackJsonpyourbike=this.webpackJsonpyourbike||[]).push([[0],{12:function(t,e,n){},13:function(t,e,n){},16:function(t,e,n){},17:function(t,e,n){"use strict";n.r(e);var a=n(1),r=n.n(a),c=n(7),i=n.n(c),o=(n(12),n(13),n.p+"static/media/logo-light.0c6a71ad.svg"),s=(n.p,n.p,n.p,n.p,n.p,n(0));function l(){return Object(s.jsx)("h1",{className:"logo",children:Object(s.jsx)("a",{target:"_blank",rel:"noreferrer",href:"https://github.com/krli07717/bikeland",children:Object(s.jsx)("img",{src:o,alt:"Bikeland"})})})}var u=function(t){return Object(s.jsx)("header",{children:Object(s.jsx)("div",{className:"header_wrapper",children:Object(s.jsx)(l,{})})})},p=n(2),d=n.n(p),b=n(4),f=n(3),h=(n(16),function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{enableHighAccuracy:!0,timeout:5e3,maximumAge:0};return new Promise((function(e,n){navigator.geolocation.getCurrentPosition((function(t){e([t.coords.latitude,t.coords.longitude])}),(function(t){n(t)}),t)}))});n(18);function v(t){return m.apply(this,arguments)}function m(){return(m=Object(b.a)(d.a.mark((function t(e){var n,a,r,c,i,o,s,l,u,p;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(e),t.prev=1,n=Object(f.a)(e,2),n[0],n[1],"https://tdx.transportdata.tw/api/basic/v2/Bike/Station/City/Taipei?%24top=30&%24spatialFilter=nearby(25.0223265,121.499511,1000)&%24format=JSON","https://tdx.transportdata.tw/api/basic/v2/Bike/Availability/City/Taipei?%24format=JSON",t.next=7,Promise.allSettled([g("https://tdx.transportdata.tw/api/basic/v2/Bike/Station/City/Taipei?%24top=30&%24spatialFilter=nearby(25.0223265,121.499511,1000)&%24format=JSON"),g("https://tdx.transportdata.tw/api/basic/v2/Bike/Availability/City/Taipei?%24format=JSON")]);case 7:for(a=t.sent,r=[],c=[a[0].value,a[1].value],o=c[1],s=(i=c[0]).map((function(t){return t.StationUID})),l=o.filter((function(t){return s.indexOf(t.StationUID)>-1})),console.log(l),u=0;u<i.length;u++)p={stationId:i[u].StationUID,stationName:i[u].StationName.Zh_tw,stationAddress:i[u].StationAddress.Zh_tw,stationPosition:{lat:i[u].StationPosition.PositionLat,lng:i[u].StationPosition.PositionLon},serviceStatus:l[u].ServiceStatus,availableRentBikes:l[u].AvailableRentBikes,availableReturnBikes:l[u].AvailableReturnBikes,srcUpdateTime:l[u].SrcUpdateTime},r.push(p);return console.log(r),t.abrupt("return",r);case 18:throw t.prev=18,t.t0=t.catch(1),t.t0;case 21:case"end":return t.stop()}}),t,null,[[1,18]])})))).apply(this,arguments)}function g(t){return y.apply(this,arguments)}function y(){return(y=Object(b.a)(d.a.mark((function t(e){var n,a,r;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j();case 2:return n=t.sent,t.prev=3,t.next=6,fetch(e,{headers:{authorization:"Bearer ".concat(n.access_token)}});case 6:return a=t.sent,t.next=9,a.json();case 9:return r=t.sent,t.abrupt("return",r);case 13:throw t.prev=13,t.t0=t.catch(3),t.t0;case 16:case"end":return t.stop()}}),t,null,[[3,13]])})))).apply(this,arguments)}function j(){return k.apply(this,arguments)}function k(){return(k=Object(b.a)(d.a.mark((function t(){var e,n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return"https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",e=new URLSearchParams({grant_type:"client_credentials",client_id:"reira.igg-178246c9-c6da-466e",client_secret:"9f16dc51-0a6e-492c-9dd6-278b917d0c67"}).toString(),t.next=5,fetch("https://tdx.transportdata.tw/auth/realms/TDXConnect/protocol/openid-connect/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});case 5:return n=t.sent,t.next=8,n.json();case 8:return t.abrupt("return",t.sent);case 9:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var O=n.p+"static/media/icon-bicycle-500.9f48f63e.svg",x=n.p+"static/media/icon-bicycle-red.90c43663.svg",w=n.p+"static/media/icon-bicycle-grey.e2b1d7d4.svg",N=n.p+"static/media/icon-parking.0d06e565.svg",S=n.p+"static/media/icon-parking-red.0b602e67.svg",B=n.p+"static/media/icon-parking-grey.84ff3ab7.svg",R=n.p+"static/media/icon-user-position-mobile.dbd42942.svg",_=n.p+"static/media/icon-geolocation.7783d3dc.svg";function P(t){var e=t.source,n=t.resultNone,a=t.resultFew,r=t.resultNormal;return 0===e?n:e<=5?a:r}var C=n(5),T=n.n(C);function U(t){var e=t.userPosition,n=t.bikesAvailable,r=t.isFindingBikes,c=t.isLocatingUser,i=t.handleLocateUser;console.log(e);var o=Object(a.useRef)(null),l=Object(a.useRef)(null),u=Object(a.useRef)([]),p=Object(s.jsx)("button",{className:"geolocation",disabled:!!c,onClick:i,children:Object(s.jsx)("img",{src:_,alt:"geo location icon"})});return Object(a.useEffect)((function(){e&&(o.current||(o.current=T.a.map("bike_map",{attributionControl:!1,zoomControl:!1,center:e,zoom:15,layers:[T.a.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'})]})))}),[e]),Object(a.useEffect)((function(){if(o.current){l.current&&o.current.removeLayer(l.current),o.current.setView(e,15);var t=T.a.icon({iconUrl:R,iconSize:[56,56]});l.current=T.a.marker(e,{icon:t}),l.current.addTo(o.current)}}),[e]),Object(a.useEffect)((function(){var t,e;o.current&&(u.current.forEach((function(t){o.current.removeLayer(t)})),u.current=[],n.forEach((function(n,a){var c=n.stationName.includes("2.0")?"Y":"N";console.log(n.stationName+"--"+c),"Y"==c?(t="twofull",e="twohalf "):(t=P({source:n.availableRentBikes,resultNone:"none",resultFew:"few",resultNormal:""}),e=P({source:n.availableReturnBikes,resultNone:"none",resultFew:"few",resultNormal:""}));var i=P({source:n.availableRentBikes,resultNone:"none",resultFew:"few",resultNormal:""}),s=P({source:n.availableReturnBikes,resultNone:"none",resultFew:"few",resultNormal:""}),l=P({source:n.availableRentBikes,resultNone:"<img src=".concat(w,' alt="bicycle icon" />'),resultFew:"<img src=".concat(x,' alt="bicycle icon" />'),resultNormal:"<img src=".concat(O,' alt="bicycle icon" />')}),p=P({source:n.availableReturnBikes,resultNone:"<img src=".concat(B,' alt="parking icon" />'),resultFew:"<img src=".concat(S,' alt="parking icon" />'),resultNormal:"<img src=".concat(N,' alt="parking icon" />')});u.current[a]=T.a.marker([n.stationPosition.lat,n.stationPosition.lng],{icon:T.a.divIcon({html:'<span class="bikeMarker_number typography-bold typography-button">\n            '.concat(r?n.availableRentBikes:n.availableReturnBikes,"</span>"),className:"bikeMarker ".concat(r?t:e)})});var d=/.*T(\d*:\d*)/g.exec(n.srcUpdateTime)[1],b='<div class="bikeMarkers_popup">\n          <h3 class="typography-bold typography-button">'.concat(n.stationName,'</h3>\n          <div class="popup_info">\n              <div class="popup_bikes ').concat(i,'">\n                  ').concat(l,'\n                  <span class="quantity typography-bold typography-button">').concat(n.availableRentBikes,'</span>\n              </div>\n              <div class="popup_parks ').concat(s,'">\n                  ').concat(p,'\n                  <span class="quantity typography-bold typography-button">').concat(n.availableReturnBikes,'</span>\n              </div>\n              <span class="update_time typography-medium typography-caption">').concat(d,"\u66f4\u65b0</span>\n          </div>\n        </div>");u.current[a].bindPopup(b,{className:"popupClass"}),u.current[a].addTo(o.current)})))}),[n,r]),Object(a.useEffect)((function(){return function(){o.current&&(o.current.remove(),o.current=null)}}),[]),e?Object(s.jsxs)("div",{id:"bike_map",children:["   ",p]}):null}n.p,n.p,n.p,n.p,n.p;var F=function(){var t=Object(a.useState)(!1),e=Object(f.a)(t,2),n=e[0],r=e[1],c=Object(a.useState)([]),i=Object(f.a)(c,2),o=i[0],l=i[1],u=Object(a.useState)(!0),p=Object(f.a)(u,2),m=p[0],g=p[1],y=Object(a.useState)(!0),j=Object(f.a)(y,2),k=j[0];function O(){return(O=Object(b.a)(d.a.mark((function t(){var e;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("handleLocateUser"),t.prev=1,t.next=4,h();case 4:e=t.sent,console.log(e),alert("userCoordinates"+e),g(!1),r(e),t.next=16;break;case 11:throw t.prev=11,t.t0=t.catch(1),console.log("setIsLocatingUser"),g(!1),t.t0;case 16:case"end":return t.stop()}}),t,null,[[1,11]])})))).apply(this,arguments)}j[1];var x=Object(a.useCallback)(Object(b.a)(d.a.mark((function t(){var e,n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h();case 2:return e=t.sent,r(e),t.next=6,v(e);case 6:n=t.sent,l(n),g(!1);case 9:case"end":return t.stop()}}),t)}))),[]);Object(a.useEffect)((function(){x()}),[x]);var w=Object(s.jsx)("div",{className:"overlay",children:Object(s.jsx)("span",{className:"typography-bold typography-h4",children:"\u5b9a\u4f4d\u4e2d"})});return Object(s.jsx)("main",{children:n?Object(s.jsx)(U,{userPosition:n,bikesAvailable:o,isFindingBikes:k,handleLocateUser:function(){return O.apply(this,arguments)},isLocatingUser:m}):w})};var L=function(){return Object(s.jsxs)(s.Fragment,{children:[Object(s.jsx)(u,{}),Object(s.jsx)(F,{})]})};i.a.render(Object(s.jsx)(r.a.StrictMode,{children:Object(s.jsx)(L,{})}),document.getElementById("root"))}},[[17,1,2]]]);
//# sourceMappingURL=main.1035a0ed.chunk.js.map